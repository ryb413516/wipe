/*!wipe-ryb1.0.0 发布日期:2018-11-19*/
function Wipe(t){this.cas=document.querySelector("#"+t.id),this.conId=t.id,this.context=this.cas.getContext("2d"),this.moveX=0,this.moveY=0,this.isMouseDown=!1,this.device=/android|webos|iPhone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase()),this.backImgUrl=t.backImgUrl,this.imgUrl=t.imgUrl,this.coverType=t.coverType,this.color=t.color||"#666",this._w=t.width||this.cas.width,this._h=t.height||this.cas.height,this.radius=t.radius||20,this.transpercent=t.percent||50,this.backImg(),this.callback=t.callback,this.drawMask(),this.addEvent()}Wipe.prototype.drawT=function(t,e,o,i){if(2===arguments.length)this.context.save(),this.context.beginPath(),this.context.arc(t,e,this.radius,0,2*Math.PI),this.context.fillStyle="rgb(250,0,0)",this.context.fill(),this.context.restore();else{if(4!==arguments.length)return!1;this.context.save(),this.context.lineCap="round",this.context.beginPath(),this.context.moveTo(t,e),this.context.lineTo(o,i),this.context.lineWidth=2*this.radius,this.context.stroke(),this.context.restore()}},Wipe.prototype.clearRect=function(){this.context.clearRect(0,0,this._w,this._h)},Wipe.prototype.getTransparencyPercent=function(){var t=0,e=this.context.getImageData(0,0,this._w,this._h);for(i=0;i<this._h;i++)for(j=0;j<this._w;j++){var o=4*(this._w*i+j)+3;0===e.data[o]&&t++}return this.percent=t/(this._w*this._h)*100,console.log(Math.ceil(this.percent)+"%"),this.percent.toFixed(2)},Wipe.prototype.drawMask=function(){if("color"===this.coverType||""===this.coverType)this.context.fillStyle=this.color,this.context.fillRect(0,0,this._w,this._h),this.context.globalCompositeOperation="destination-out";else if("image"===this.coverType){var t=this,e=new Image;e.src=this.imgUrl,e.onload=function(){t.context.drawImage(e,0,0,t._w,t._h),t.context.globalCompositeOperation="destination-out"}}},Wipe.prototype.addEvent=function(){var s,c,o,n,r,t=this.device?"touchstart":"mousedown",e=this.device?"touchmove":"mousemove",i=this.device?"touchend":"mouseup",h=this;this.cas.addEventListener(t,function(t){for(s=h.cas.offsetLeft,c=h.cas.offsetTop,o=h.cas;o=o.offsetParent;)s+=o.offsetLeft,c+=o.offsetTop;n=document.documentElement.scrollTop||document.body.scrollTop,r=document.documentElement.scrollLeft||document.body.scrollLeft;var e=t||window.event;h.moveX=h.device?e.touches[0].clientX-s+r:e.clientX-s+r,h.moveY=h.device?e.touches[0].clientY-c+n:e.clientY-c+n,h.drawT(h.moveX,h.moveY),h.isMouseDown=!0}),this.cas.addEventListener(e,function(t){if(n=document.documentElement.scrollTop||document.body.scrollTop,r=document.documentElement.scrollLeft||document.body.scrollLeft,!h.isMouseDown)return!1;var e=t||window.event;e.preventDefault();var o=h.device?e.touches[0].clientX-s+r:e.clientX-s+r,i=h.device?e.touches[0].clientY-c+n:e.clientY-c+n;h.drawT(h.moveX,h.moveY,o,i),h.moveX=o,h.moveY=i},!1),this.cas.addEventListener(i,function(t){h.isMouseDown=!1;var e=h.getTransparencyPercent();h.callback.call(null,e,h.transpercent),e>h.transpercent&&h.clearRect()},!1)},Wipe.prototype.backImg=function(){this.cas.style.cssText="background:url("+this.backImgUrl+") center 0 no-repeat; background-size: cover;"};